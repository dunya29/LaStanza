const fixedBlocks=document.querySelectorAll(".fixed-block"),customSelect=document.querySelectorAll(".custom-select"),overlay=document.querySelector(".overlay"),header=document.querySelector(".header"),iconMenu=document.querySelector(".icon-menu"),modalShowBtn=document.querySelectorAll(".modal-show-btn"),modal=document.querySelectorAll(".modal"),feedbackModal=document.querySelector(".feedback-modal"),successModal=document.querySelector(".success-modal"),errorModal=document.querySelector(".error-modal");let animSpd=400;function sprite(e){return'<svg><use xlink:href="img/icons/sprite.svg#'+e+'"></use></svg>'}function enableScroll(){fixedBlocks&&fixedBlocks.forEach((e=>e.style.paddingRight="0px")),document.body.style.paddingRight="0px",document.body.classList.remove("no-scroll")}function disableScroll(){paddingValue=window.innerWidth>325?window.innerWidth-document.documentElement.clientWidth+"px":0,fixedBlocks&&fixedBlocks.forEach((e=>e.style.paddingRight=paddingValue)),document.body.style.paddingRight=paddingValue,document.body.classList.add("no-scroll")}function smoothDrop(e,t,r){if(t.style.overflow="hidden",t.style.transition=`height ${r}ms ease`,t.style["-webkit-transition"]=`height ${r}ms ease`,e.classList.contains("active")){e.classList.remove("open");let c=t.clientHeight+"px";t.style.height=c,setTimeout((function(){t.style.height="0",setTimeout((()=>{t.style.display="none",t.style.height=null,e.classList.remove("active")}),r)}),0)}else{e.classList.add("open"),t.style.display="block";let c=t.clientHeight+"px";t.style.height="0px",setTimeout((function(){t.style.height=c,setTimeout((()=>{t.style.height=null,e.classList.add("active")}),r)}),0)}}function tabSwitch(e,t){e.forEach(((r,c)=>{r.addEventListener("click",(()=>{r.getAttribute("data-nav");e.forEach((e=>{e.classList.remove("active")})),t.forEach((e=>{e.classList.remove("active")})),r.classList.add("active"),t[c].classList.add("active"),r.style.opacity="0",t[c].style.opacity="0",setTimeout((()=>{r.style.opacity="1",t[c].style.opacity="1"}),0)}))}))}function formSuccess(e){e.querySelectorAll(".item-form").forEach((e=>e.classList.remove("error"))),e.querySelectorAll("input").forEach((e=>{["hidden","checkbox","radio"].includes(e.type)||(e.value=""),["checkbox","radio"].includes(e.type)&&!e.classList.contains("required")&&(e.checked=!1)})),e.querySelector("textarea")&&(e.querySelector("textarea").value=""),e.querySelector(".file-form__items")&&(e.querySelector(".file-form__items").innerHTML="");let t=document.querySelector(".modal.open");t&&t.classList.remove("open"),openModal(successModal)}function openModal(e){iconMenu.classList.contains("show")||disableScroll(),e.classList.add("open")}function closeModal(e){e.classList.remove("open"),setTimeout((()=>{iconMenu.classList.contains("show")||enableScroll()}),animSpd)}modal.forEach((e=>{e.addEventListener("click",(t=>{e.querySelector(".modal__content").contains(t.target)&&!e.querySelector(".modal__close").contains(t.target)||closeModal(e)}))})),modalShowBtn.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();let r=e.getAttribute("data-modal");openModal(document.getElementById(r))}))}));const accordion=document.querySelectorAll(".accordion");accordion.forEach((e=>{e.querySelector(".accordion__header").addEventListener("click",(t=>{"input"!=t.target.localName&&smoothDrop(e.querySelector(".accordion__header"),e.querySelector(".accordion__body"),500)}))}));const cardSwiper=document.querySelectorAll(".card-swiper");cardSwiper&&cardSwiper.forEach((e=>{new Swiper(e.querySelector(".swiper"),{slidesPerView:4,spaceBetween:30,observe:!0,observeParents:!0,navigation:{prevEl:e.querySelector(".nav-btn--prev"),nextEl:e.querySelector(".nav-btn--next")},speed:800})}));const filter=document.querySelector(".filter"),filterSelected=document.querySelector(".filter-selected__items");if(filter&&filterSelected){const e={checkInp:function(e){e.checked=!0,e.setAttribute("checked",!0)},uncheckInp:function(e){e.checked=!1,e.removeAttribute("checked")},setSelected:function(e){let t=e.parentNode.querySelector("span:last-child").textContent,r=e.getAttribute("data-id");filterSelected.insertAdjacentHTML("afterbegin",`<div class="filter-selected__item" data-target="${r}">${t}${sprite("close")}</div>`)},removeSelected:function(e){filterSelected.querySelector(`[data-target="${e}"]`)&&filterSelected.querySelector(`[data-target="${e}"]`).remove()},selectedOnClick:function(e){filterSelected.querySelectorAll(".filter-selected__item").forEach(((t,r)=>{if(t.contains(e.target)){let e=t.getAttribute("data-target");filter.querySelectorAll("input")[e].click(),t.remove()}}))},resetFilter:function(){filter.querySelectorAll("label input").forEach((e=>{e.checked=!1,e.removeAttribute("checked")})),filterSelected.innerHTML=""}};filter.querySelectorAll("label input").forEach(((t,r)=>{t.setAttribute("data-id",r);let c=t.getAttribute("data-id");if(t.addEventListener("change",(()=>{t.checked?e.setSelected(t):e.removeSelected(c)})),t.parentNode.parentNode.classList.contains("accordion__header")){let r=t.closest(".accordion").querySelector(".accordion__body").querySelectorAll("label input");t.addEventListener("change",(()=>{t.checked?r.forEach((t=>{e.checkInp(t),e.removeSelected(t.getAttribute("data-id"))})):r.forEach((t=>e.uncheckInp(t)))})),r.forEach((a=>{a.addEventListener("change",(()=>{Array.from(r).every((e=>e.checked))?(e.checkInp(t),setTimeout((()=>{r.forEach((t=>{e.removeSelected(t.getAttribute("data-id"))})),e.setSelected(t)}),0)):t.checked&&(e.uncheckInp(t),e.removeSelected(c),r.forEach((t=>{t.checked&&e.setSelected(t)})))}))}))}})),filterSelected.addEventListener("click",(t=>e.selectedOnClick(t))),document.querySelector(".filter-selected__reset").addEventListener("click",(()=>e.resetFilter()))}const extraList=document.querySelectorAll(".extra-list");function openSelectCustom(e){e.classList.add("open"),e.setAttribute("aria-expanded",!0),e.querySelectorAll(".custom-select__options input").forEach((t=>{t.addEventListener("change",(t=>{setActiveOption(e),closeSelectCustom(e)}))})),document.addEventListener("click",(function t(r){e.contains(r.target)||(closeSelectCustom(e),document.removeEventListener("click",t))}))}function setActiveOption(e){let t=e.querySelector("input:checked").nextElementSibling.innerHTML;e.querySelector(".custom-select__selected span").innerHTML=t}function closeSelectCustom(e){e.classList.remove("open"),e.setAttribute("aria-expanded",!1)}extraList&&extraList.forEach((e=>{e.querySelector(".extra-list__btn").addEventListener("click",(()=>{e.classList.contains("open")?(e.classList.remove("open"),e.querySelector(".extra-list__btn span").textContent="Показать еще"):(e.classList.add("open"),e.querySelector(".extra-list__btn span").textContent="Скрыть все")}))})),customSelect&&customSelect.forEach((e=>{e.querySelector(".custom-select__selected").addEventListener("click",(()=>{e.classList.contains("open")?closeSelectCustom(e):openSelectCustom(e)}))}));const product=document.querySelector(".product");if(product){const t=document.querySelectorAll(".item-texture"),r=document.querySelector(".texture-modal"),c=document.querySelector("#orderPafarmsForm"),a=document.querySelector(".params-product__colorize"),o=document.querySelector(".params-product__reflect"),i=document.querySelector(".params-product__greyscale"),n=document.querySelector(".size-product"),l=document.getElementById("imageCrop"),s=document.querySelector(".main-product__img");let u,d,p,m=0;const h={width:+c.querySelector("input[name=width]").value,height:+c.querySelector("input[name=height]").value,aRatio:+c.querySelector("input[name=aRatio]").value,aRatioDefault:+c.querySelector("input[name=aRatioDefault]").value,square:+c.querySelector("input[name=square]").value,greyscale:c.querySelector("input[name=greyscale]").value,reflectX:c.querySelector("input[name=reflectX]").value,imgStartX:+c.querySelector("input[name=imgStartX]").value,imgStartY:+c.querySelector("input[name=imgStartY]").value,cropped:c.querySelector("input[name=cropped]").value,colorize:c.querySelector("input[name=colorize]").value,texture:c.querySelector("input[name=texture]").value,selfSize:c.querySelector("input[name=selfSize]").value,designPrice:c.querySelector("input[name=designPrice]").value,priceStandart:+c.querySelector("input[name=priceStandart]").value,priceDesign:+c.querySelector("input[name=priceDesign]").value,priceTotal:+c.querySelector("input[name=priceTotal]").value,imgURl:c.querySelector("input[name=imgURl]").value},g=Object.assign({},h);function setTotal(){document.querySelector(".total-product__price").textContent=String(g.designPrice?g.priceDesign:g.priceStandart).replace(/\B(?=(\d{3})+(?!\d))/g," ").trim(),document.querySelector(".total-product__square").textContent=g.square,g.priceTotal=Math.round(g.square*(g.designPrice?g.priceDesign:g.priceStandart)),c.querySelector("input[name=priceTotal]").value=g.priceTotal,document.querySelector(".total-product__totalprice").textContent=String(g.priceTotal).replace(/\B(?=(\d{3})+(?!\d))/g," ").trim()}function setDesignPrice(){g.reflectX||g.greyscale||g.imgStartX||g.cropped||g.selfSize?g.designPrice=!0:g.designPrice=!1,c.querySelector("input[name=designPrice]").value=g.designPrice,setTotal()}function setSize(){g.square=(g.width*g.height/1e4).toFixed(2),c.querySelector("input[name=square]").value=g.square,c.querySelector("input[name=width]").value=g.width,c.querySelector("input[name=height]").value=g.height,n.querySelector("input[name=selfWidth]").value=g.width,n.querySelector("input[name=selfHeight]").value=g.height,document.querySelector(".main-product__width span").textContent=g.width,document.querySelector(".main-product__height span").textContent=g.height,setTotal()}function imgStartX(e){e.target.classList.contains("prev")?g.reflectX?m+=2:m-=2:g.reflectX?m-=2:m+=2,d.style.backgroundPosition=`${m}px center`,s.style.backgroundPosition=`${document.querySelector(".main-product__btn").clientWidth+m}px center`,u.setCropBoxData(u.getCropBoxData())}function setImg(){p&&g.selfSize?htmlToImage.toJpeg(p).then((function(e){g.imgURl=e})).catch((function(e){g.imgURl=h.imgURl,console.error("oops, something went wrong!",e)})):g.imgURl=h.imgURl,c.querySelector("input[name=imgURl]").value=g.imgURl}document.querySelectorAll(".main-product__mainswiper .media-contain").forEach((e=>e.style.paddingTop=h.height/h.width*100+"%")),document.querySelector(".main-product__ratio span").style.paddingTop=h.height/h.width*100+"%";const S=new Swiper(".main-product__thumbs",{slidesPerView:3.55,spaceBetween:12,observer:!0,observeParents:!0,speed:800});new Swiper(".main-product__mainswiper",{slidesPerView:1,observer:!0,observeParents:!0,effect:"fade",speed:0,thumbs:{swiper:S}});if(t&&r){const v=new Swiper(r.querySelector(".swiper"),{slidesPerview:1,observe:!0,observeParents:!0,effect:"fade",navigation:{nextEl:r.querySelector(".nav-btn--next"),prevEl:r.querySelector(".nav-btn--prev")}});t.forEach(((e,t)=>{e.querySelector(".media-cover").addEventListener("click",(()=>{v.slideTo(t),openModal(r)}))})),r.querySelectorAll(".texture-modal__btn").forEach(((e,a)=>{e.addEventListener("click",(e=>{if(!t[a].classList.contains("selected")){t.forEach((e=>{e.classList.remove("selected")})),t[a].classList.add("selected");let r=e.target.getAttribute("data-texture-name"),o=e.target.getAttribute("data-texture-priceStandart"),i=e.target.getAttribute("data-texture-priceDesign");g.texture=r,g.priceStandart=o,g.priceDesign=i,c.querySelector("input[name=texture]").value=r,c.querySelector("input[name=priceStandart").value=o,c.querySelector("input[name=priceDesign").value=i,setTotal()}closeModal(r)}))}))}let y;a.querySelector("input").addEventListener("change",(e=>{g.colorize=!!e.target.checked,c.querySelector("input[name=colorize]").value=e.target.checked})),o.querySelector("input").addEventListener("change",(e=>{g.reflectX=!!e.target.checked,c.querySelector("input[name=reflectX]").value=e.target.checked,e.target.checked?u.scale(-1,1):u.scale(1,1),s.classList.toggle("reverse"),d.classList.toggle("reverse"),p.classList.toggle("reverse"),setDesignPrice()})),i.querySelector("input").addEventListener("change",(e=>{g.greyscale=!!e.target.checked,c.querySelector("input[name=greyscale]").value=e.target.checked,s.classList.toggle("greyscale"),d.classList.toggle("greyscale"),p.classList.toggle("greyscale"),setDesignPrice()})),n.querySelectorAll(".size-product__btn").forEach((e=>{e.addEventListener("click",(()=>{n.querySelectorAll(".size-product__btn").forEach((e=>{e.classList.remove("active")})),e.classList.toggle("active"),e.classList.contains("self-size")?(g.selfSize=!0,document.querySelector(".main-product__preview").classList.remove("swiper-show")):(g.selfSize=!1,document.querySelector(".main-product__preview").classList.add("swiper-show"),u.reset(),g.width=+n.querySelector(".custom-select").querySelector("input[type=radio]:checked").getAttribute("data-width"),g.height=+n.querySelector(".custom-select").querySelector("input[type=radio]:checked").getAttribute("data-height"),setSize()),c.querySelector("input[name=selfSize]").value=g.selfSize,setDesignPrice()}))})),n.querySelector(".custom-select").querySelectorAll("input").forEach((e=>{e.addEventListener("change",(()=>{g.width=+e.getAttribute("data-width"),g.height=+e.getAttribute("data-height"),setSize()}))})),n.querySelector(".size-product__fixed").addEventListener("change",(e=>{e.target.checked?(g.aRatio=g.width/g.height,u.options.aspectRatio=g.aRatio):(g.aRatio=g.aRatioDefault,u.options.aspectRatio=""),c.querySelector("input[name=aRatio]").value=g.aRatio})),document.querySelectorAll(".size-product__inp input").forEach((e=>{e.addEventListener("change",(e=>{if(Number.isInteger(e.target.value)||e.target.value>0){let t=+n.querySelector(".custom-select").querySelector("input[type=radio]:checked").getAttribute("data-width"),r=+n.querySelector(".custom-select").querySelector("input[type=radio]:checked").getAttribute("data-height");g.aRatio!=g.aRatioDefault&&("selfHeight"==e.target.name?n.querySelector("input[name=selfWidth]").value=Math.round(n.querySelector("input[name=selfWidth]").value*(e.target.value/g.height)):"selfWidth"==e.target.name&&(n.querySelector("input[name=selfHeight]").value=Math.round(n.querySelector("input[name=selfHeight]").value*(e.target.value/g.width))));let c=Math.round(n.querySelector("input[name=selfWidth]").value),a=Math.round(n.querySelector("input[name=selfHeight]").value),o=c/t*100,i=a/r*100,l=1,s=1;o>100&&(l=o/100),i>100&&(s=i/100),o>i?i/=l:o<i&&(o/=s),g.width=c,g.height=a;let d={left:(u.containerData.width-u.containerData.width*o/100)/2,top:(u.containerData.height-u.containerData.height*i/100)/2,width:o>100?u.containerData.width:u.containerData.width*o/100,height:i>100?u.containerData.height:u.containerData.height*i/100};u.setCropBoxData(d)}else n.querySelector("input[name=selfWidth]").value=g.width,n.querySelector("input[name=selfHeight]").value=g.height}))})),document.querySelectorAll(".main-product__btn").forEach((e=>{e.addEventListener("mousedown",(e=>{clearInterval(y),y=setInterval((()=>{imgStartX(e)}),50)})),e.addEventListener("mouseup",(e=>{clearInterval(y)})),e.addEventListener("touchstart",(e=>{clearInterval(y),y=setInterval((()=>{imgStartX(e)}),50)})),e.addEventListener("touchend",(e=>{clearInterval(y)}))})),u=new Cropper(l,{viewMode:2,movable:!1,zoomable:!1,rotatable:!1,autoCropArea:1,dragMode:"none",ready:function(e){u.zoomTo(1),d=document.querySelector(".cropper-canvas"),d.style.backgroundImage=`url(${u.image.currentSrc}`,document.querySelector(".cropper-view-box").innerHTML+="<span></span>",p=document.querySelector(".cropper-view-box span"),p.style.backgroundImage=`url(${u.image.currentSrc}`,p.style.backgroundSize=`${u.containerData.width}px ${u.containerData.height}px`,p.style.backgroundPosition=`-${u.getCropBoxData().left-m}px -${u.getCropBoxData().top}px`},crop:function(e){p&&(p.style.backgroundSize=`${u.containerData.width}px ${u.containerData.height}px`,p.style.backgroundPosition=`${-u.getCropBoxData().left+m}px ${-u.getCropBoxData().top}px`);let t=Math.round(Math.abs(u.getCropBoxData().left-m)%u.containerData.width);m-u.getCropBoxData().left<=0?g.imgStartX=t:g.imgStartX=u.containerData.width-t>1&&t>1?u.containerData.width-t:0,g.imgStartY=Math.round(u.getCropBoxData().top),c.querySelector("input[name=imgStartX").value=g.imgStartX,c.querySelector("input[name=imgStartY").value=g.imgStartY;let r=+n.querySelector(".custom-select").querySelector("input[type=radio]:checked").getAttribute("data-width"),a=+n.querySelector(".custom-select").querySelector("input[type=radio]:checked").getAttribute("data-height"),o=u.cropBoxData.width/u.containerData.width*100,i=u.cropBoxData.height/u.containerData.height*100,l=1,s=1,d=1;(g.width>r||g.height>a)&&(l=g.width/r,s=g.height/a,d=l>=s?l:s),g.width=Math.round(r*o*d/100),g.height=Math.round(a*i*d/100),setSize(),setTimeout(setImg,2e3)},cropmove:function(e){}})}